# Unfortunately, strips trailing LFs
core_snippet_raw_encoder()
{
	core_variable_setVariable _core_snippet_embeddedData_${snippetName} "$(<"$snippetFilePath")"
}

core_snippet_raw_decoder()
{
	local core_variable_indirectValue_result
	core_variable_indirectValue _core_snippet_embeddedData_${snippetName}
	printf '%s' "$core_variable_indirectValue_result"
}

# Strips trailing LFs but does not matter, as does not affect base64 representation
# MacOSX and CoreUtils work the same way but create differently formatted data
# * Encode (has a trailing LF): base64 <file>
# * Decode: base64 -D <file>
# CoreUtils
# * Encode (line breaks and trailing line break unless using --wrap 0): base64 --wrap 0
# * Decode: base64 -d <file>
# uuencode -m is a non-starter (not installed by default on Ubuntu, although part of busybox and MacOSX)
core_dependency_requires '*' base64
core_snippet_base64_encoder()
{
	_core_snippet_embeddedData_${snippetName}="$(base64 --wrap 0 "$snippetFilePath")"
}

# MacOSX uses base64 -D
# Openssl uses openssl enc -base64 -d
# Busybox seems to have base64 but it's not enabled in Debian/Ubuntu and missing from the man page
core_dependency_requires '*' base64
core_snippet_base64_decoder()
{
	base64 -d <<-EOF
		$(core_variable_indirectValue _core_snippet_embeddedData_${snippetName})
	EOF
}

core_usesIn core variable
core_snippet_embed()
{
	local codecName="$1"
	shift 1
	
	local encoder="core_snippet_${codecName}_encoder"
	
	local snippetName
	local snippetFilePath
	for snippetName in "$@"
	do
		if core_variable_isSet _core_snippet_embeddedData_${snippetName}; then
			continue
		fi
		
		snippetFilePath="$_program_libPath"/"${_program_namespace}"/"$snippetName".snippet
		if ! core_path_isReadableNonEmptyFilePath "$snippetFilePath"; then
			core_exitError $core_commandLine_exitCode_SOFTWARE "Snippet '$snippetName' does not exist as a readable, non-empty file at '$snippetFilePath'"
		fi
		
		${encoder}
		core_dependency_declares _core_snippet_embeddedData_${snippetName}
		
		core_variable_setVariable _core_snippet_embeddedCodec_${snippetName} $codecName
		core_dependency_declares _core_snippet_embeddedCodec_${snippetName}
	done
}

core_snippet_retrieve()
{
	local snippetName
	local core_variable_indirectValue_result
	local codec
	local decoder
	for snippetName in "$@"
	do
		core_variable_indirectValue _core_snippet_embeddedCodec_${snippetName}
		codec="$core_variable_indirectValue_result"
		decoder="core_snippet_${codec}_decoder"
		${decoder}
	done
}
